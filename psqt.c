#include "psqt.h"
#include "evaluate.h"

//all of these are from black's perspective to avoid the weird upside down shit

//The values are from Weiss as a starting point then tuned for BCE

int PSQT[13][64];

static const int pieceSqValue[7][64] = {
        {0}, //null
        { //pawn
                0,          0,          0,          0,          0,          0,          0,          0,
                S( 26, 25), S( 18, 21), S( 23, 21), S( 25, 28), S( 32,  8), S( 11,  7), S( 22, 19), S( 15, 22),
                S( 19, 25), S( 13, 12), S( 16, 17), S( 19, 18), S( 17, 15), S( 14,  4), S( 23, 13), S( 22, 20),
                S(  3, 16), S( -2, 11), S( -2,  7), S(  4,  1), S( 20,  0), S( 13,  2), S(  3,  3), S(  5, 10),
                S( -4,  4), S(-17,  7), S(  1, -1), S( 15,  8), S( 13,  8), S( 10, -3), S(-12,  3), S( -1,  1),
                S( -1,  0), S( -7, -2), S( -3, -1), S(  2,  4), S(  8,  5), S( -4,  2), S( 9,  5), S(  5,  4),
                S( 10,  5), S(  0,  0), S(  1, -5), S(  1,-14), S(  3, -2), S( 23,  8), S( 17,  7), S(  7,  0),
                0,          0,          0,          0,          0,          0,          0,          0
        },
        { //knight
                S(-36,-53), S( -7,-9), S(-12,-12), S( -2,-9), S(  1, -4), S(-9,-9), S(-15,-15), S(-49,-40),
                S(-25,-21), S( -3,  8), S( 9, -1), S( 13,  8), S(  3, 15), S(  8, 12), S(  5, -8), S(-27,-19),
                S(-14,-11), S(  4, 12), S(  6,  4), S( 26, 12), S( 27, 22), S( 13,  1), S( 12, 10), S( -5, -7),
                S( -6,-14), S(  3,  6), S( 22, 21), S( 33, 22), S( 28, 26), S( 24, 23), S( 19,  8), S(-9, -3),
                S(-9, -5), S( 11,  8), S( 16,  8), S( 16, 16), S( 22, 31), S( 21, 12), S( 10,  3), S(  5, -7),
                S(-23,-11), S(-12, -5), S( -7,  4), S(  3,  7), S( 13,  5), S( -3,  6), S(  5,  1), S(-14,-14),
                S(-23,-16), S(  0, -8), S( -1, -6), S(  0, -6), S( -5,  2), S( -2, -4), S( -5,  4), S(-14,-14),
                S(-48,-52), S(-12,-9), S(-13,-13), S( -5, -7), S(-12, -4), S(-12,-17), S(-10, -8), S(-41,-38)
        },
        //todo tune
        { //bishop
                S(  4,  2), S(  3, -9), S(  0,  7), S(  1, -8), S(  1, -1), S( -3, -3), S( -5, -1), S(  0, -1),
                S( -4, -6), S(  1, -5), S(  0,  1), S(  9,  7), S( 15, 15), S( -3, -8), S( -1,  3), S(  5,  1),
                S(  4,  5), S(  4,  0), S(  6, 13), S( 16, 12), S( 12, 13), S( 16, 16), S(  3, -1), S(  6,  3),
                S(  6, -1), S(  8, 11), S( 18, 14), S( 25, 19), S( 24, 20), S( 24, 11), S( 16, 13), S( -2, -1),
                S( -1, 11), S(  9, 12), S( 10, 17), S( 21, 18), S( 20, 28), S( 12, 20), S(  1, 12), S(  6, -3),
                S(  1,  2), S(  6,  6), S(  6,  9), S( 17, 14), S( 12, 20), S(  9, 10), S( 15, -2), S(  5,  0),
                S(  3, -8), S(  6,  7), S(  6,  6), S( -6,  7), S(  3, 13), S(  2,  0), S( 20, 11), S(  0, -2),
                S( -2,  2), S(  2,  2), S(  2,-11), S(  1, -1), S( -2,  3), S(-13, -6), S( -3,  1), S( -1, -3)
        },
        { //rook
                S(  7,  9), S( -1, -2), S( 13, 13), S(  3,  7), S( 18,  3), S(  0,  3), S(  5,  1), S( -6,  3),
                S( 27, 27), S( 21, 28), S( 29, 30), S( 27, 34), S( 21, 31), S( 21, 39), S( 31, 33), S( 29, 28),
                S(  1, 11), S(  1, 18), S(  3,  6), S( 10, 18), S( 17, 11), S( 10,  7), S(  3,  5), S(  9, -8),
                S( -1,  2), S( -2, -5), S( 10,  8), S(  6, 14), S(  7,  8), S(  2,  3), S( -2, -3), S(  0,  7),
                S( -8,  8), S(  2, -1), S(  7,  9), S( 16, 14), S( 10, 14), S(  7,  2), S( -2,  6), S(  8, -9),
                S( -9, -3), S(-10,  9), S(  0,  3), S(  4,  3), S( 11,  6), S( -4,  5), S( 10,  1), S( -3, -6),
                S(  2,  1), S( -6,  3), S(  7, -1), S(  6,  6), S( 12,  4), S( -2, -6), S(  0,  3), S( -6,  7),
                S( -5, 14), S(  2, -7), S(  2,  6), S(  5,  1), S(  5,  1), S( -4, 14), S( 12,  1), S( -2,  2)
        },
        { //queen
                S( -9, -1), S(  0, -1), S( 13, -2), S(  0,  8), S( -4, -5), S(  6,  1), S(-10,-14), S(  1,  1),
                S(  1, -6), S(-33,  1), S( -9,  5), S( -5,  2), S( -4, 18), S( 13,  4), S( -1,  1), S( 12, -3),
                S(  2,  6), S(  4, -8), S( -2, -2), S(  3, -6), S( 17,  6), S(  4,  3), S( 10, 12), S( 19,  1),
                S(-10, -8), S( -3,  4), S(  8, -7), S(  1,  5), S( 13,  4), S(  9,  8), S( 13,  1), S( 26,  4),
                S( -1,  5), S(-13, -4), S( -4,  0), S( -2,  6), S( -7, -5), S( -1,  7), S( 22, 12), S( 17,  5),
                S( -4, -2), S( -2,-13), S(-12,  4), S( -4,-10), S( -7,-17), S( -3, 12), S( 22, -7), S(  0,  8),
                S(  2,  3), S( -4,  0), S(  0, -3), S( -2, -7), S( -2, -3), S( -8, 15), S(-16, -3), S( -6,-14),
                S( -3,  4), S(  0, -7), S(-10, -5), S( -8, -2), S(-11,  4), S( -7,-10), S( -3,-10), S(  9, -3)
        },
        { // king
                S(-73,-47), S(-54,-26), S(-72,  7), S(-66, 21), S(-76,  6), S(-70,-25), S(-67,-15), S(-64,-63),
                S(-62,-32), S(-34,  8), S(-57, 32), S(-63, 10), S(-37, 24), S(-54, 24), S(-39,  6), S(-54,-28),
                S(-25, -9), S(-24, 38), S(-24, 46), S( -7, 42), S(-12, 36), S( -8, 46), S(-20, 27), S(-39, -7),
                S(-16,  7), S(-12, 36), S(-27, 43), S(  1, 39), S(-22, 51), S( -3, 34), S(-20, 43), S(-25, -6),
                S( 11, -7), S( -5, 31), S( -1, 37), S( -2, 35), S(-13, 36), S(-12, 28), S( -2,  8), S(-19,-26),
                S(  5,-18), S( 30,-10), S(  2, 13), S(-23, 24), S(  0, 18), S(  1,  3), S(  3, -1), S(  5,-29),
                S( 43,-22), S( 25, -7), S( 23, -5), S(-16, 10), S(-23, 11), S(  7,  0), S( 63,-24), S( 42,-48),
                S(  5,-57), S( 80,-57), S( 66,-27), S(-53, -3), S( 37,-43), S(-33,-24), S( 69,-63), S( 43,-102)
        }
};


//based on Weiss
static __attribute__((constructor)) void initPSQT() {
    for(int type = bP; type <= bK; type++) {
        for(int sq = A1; sq <= H8; sq++) {
            //Base piece value + piece square value
            PSQT[type][SQ64(sq)] = -(pieceSqValue[BLACKTOWHITE(type)][SQ64(sq)] + pieceVal[type]);
            //inverse for white
            PSQT[BLACKTOWHITE(type)][MIRROR64(SQ64(sq))] = -PSQT[type][SQ64(sq)];
        }
    }
}